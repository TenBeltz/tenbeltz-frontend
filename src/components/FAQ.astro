---
import { ReactComponent as ChevronDown } from "@/assets/icons/chevron-down-outline.svg";
import { ScrollReveal } from "./ScrollReveal";

interface FAQ {
  question: string;
  answer: string;
}

const FAQs: FAQ[] = [
  { 
    question: '¿Cómo saber si un caso de uso de IA es viable en costes y escalabilidad?',
    answer: 'Definimos el volumen esperado, el coste objetivo por petición y la métrica de fiabilidad antes de construir.',
  },
  { 
    question: '¿Cómo medís la fiabilidad en producción?',
    answer: 'Combinamos evals automáticas, golden set, revisión humana y guardrails con fallback cuando el modelo falla.',
  },
  { 
    question: '¿Cómo reducís costes sin perder calidad?',
    answer: 'Usamos rutas baratas, caching, batching, modelos mixtos y límites por feature.',
  },
  { 
    question: '¿Qué pasa con datos sensibles y privacidad?',
    answer: 'Aplicamos clasificación de datos, redacción de PII, políticas de acceso y trazabilidad completa.',
  },
  { 
    question: '¿Qué entregables incluye un Audit o un Sprint?',
    answer: 'Hoja de ruta por fases, métricas de fiabilidad, baseline de costes y plan de escalado.',
  },
  { 
    question: '¿Trabajáis con nuestro equipo y stack actual?',
    answer: 'Sí. Nos integramos con tu equipo de producto e ingeniería, dejando documentación y handoff para que todo quede operativo.',
  },
]
---

<section id="faq">
  <div class="flex flex-col items-center justify-center px-4 py-20 text-white gap-y-16 lg:px-16">
    <ScrollReveal client:load className="flex flex-col max-w-2xl text-center gap-y-7">
      <h2 class="text-4xl font-bold">Preguntas frecuentes</h2>
      <p class="text-slate-400">
        ¿Tienes otra pregunta y no encuentras la respuesta? 
        <a href="#contact-section" class="font-bold text-pheromone-purple">Escríbenos</a> y te respondemos cuanto antes.
      </p>
    </ScrollReveal>
    <div class="grid lg:grid-cols-2 gap-x-40 gap-y-6 lg:gap-y-14">
      {FAQs.map(({ question, answer }, index) => (
        <ScrollReveal client:load delay={index * 100} className="flex flex-col max-w-md overflow-hidden cursor-pointer faq-item lg:cursor-auto">
          <p class="flex text-lg font-semibold gap-x-1">
            <span>{question}</span>
            <span>
              <ChevronDown
                width="24"
                height="24"
                fill="none"
                strokeWidth="1.5"
                stroke="currentColor"
                className="size-6 lg:hidden transform transition-transform duration-200"
              />
            </span>
          </p>
          <p class="pt-6 overflow-hidden transition-all duration-200 ease-in-out faq-answer text-slate-400 max-h-0 lg:max-h-max">{answer}</p>
        </ScrollReveal>
      ))}
    </div>
  </div>
</section>

<script>
  function initializeFAQ() {
    const faqItems: NodeListOf<Element> = document.querySelectorAll('.faq-item');

    const toggleAnswer = (item: Element, answer: HTMLParagraphElement) => {
      const chevron = item.querySelector('svg');

      const isOpen = answer.style.maxHeight && answer.style.maxHeight !== '0px';
      answer.style.maxHeight = isOpen ? '0px' : `${answer.scrollHeight}px`;

      if (chevron) chevron.classList.toggle('rotate-180', !isOpen);
    };

    const handleResize = () => {
      faqItems.forEach(item => {
        const answer = item.querySelector('.faq-answer') as HTMLParagraphElement;
        if (window.innerWidth >= 1024) {
          answer.style.maxHeight = `${answer.scrollHeight}px`;
        } else {
          answer.style.maxHeight = '0px';
        }
      });
    };

    const debounce = (func: (...args: any[]) => void, wait: number) => {
      let timeout: ReturnType<typeof setTimeout>;
      return function(this: any, ...args: any[]) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    };

    window.addEventListener('resize', debounce(handleResize, 200));

    faqItems.forEach(item => {
      const answer = item.querySelector('.faq-answer') as HTMLParagraphElement;

      item.addEventListener('click', () => {
        if (window.innerWidth < 1024 && answer) toggleAnswer(item, answer);
      });
    });

    handleResize();
  }

  window.addEventListener('DOMContentLoaded', initializeFAQ);
</script>
